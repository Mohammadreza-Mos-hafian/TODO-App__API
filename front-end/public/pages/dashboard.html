<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      rel="shortcut icon"
      href="../images/icons/favicon.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/font.css" />
    <link rel="stylesheet" href="../css/app.css" />

    <title>Task Management | Dashboard</title>
  </head>
  <body>
    <header class="header">
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container d-flex justify-content-between">
          <h4 class="app_name text-white">
            <a href="http://127.0.0.1:3000/public/pages/dashboard.html"
              >Task Management</a
            >
          </h4>
          <div class="d-flex align-items-center justify-content-center gap-2">
            <span class="user-name text-white fs-6"></span>

            <button type="button" class="btn text-bg-danger btn-sm" id="logoutBtn">
              <img
                src="../images/icons/turn_off.svg"
                alt="Turn off"
                title="Logout"
              />
            </button type="button">
          </div>
        </div>
      </nav>
    </header>

    <div class="container text-center mt-5">
      <h2 class="text-center">Welcome to Task Management dashboard</h2>

      <div class="row mt-4 d-flex justify-content-center">
        <div class="col-md-4">
          <a
            href="../pages/tasks/task_create.html"
            class="btn btn-success w-100"
            >Create Task</a
          >
        </div>

        <div class="col-md-4">
          <a href="../pages/tasks/task_index.html" class="btn btn-primary w-100"
            >Show Tasks</a
          >
        </div>
      </div>
    </div>

    <footer class="text-center mt-5">
      <p>&copy;2025 Task Management | All rights reserved.</p>
    </footer>

    <script src="../js/bootstrap.bundle.min.js"></script>
    <script>
      const isAuthenticated = async (token) => {
        try {
          const response = await fetch(
            "http://127.0.0.1:5000/api/dashboard/home",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${token}`,
              },
            }
          );

          if (!response.ok) {
            localStorage.removeItem("access_token");
            window.location.assign(
              "http://127.0.0.1:3000/public/index.html"
            );
            return;
          }

          const data = await response.json();

          document.querySelector(
            ".user-name"
          ).textContent = `${data.full_name}`;
        } catch (err) {
          console.error("Unexpected error:", err);
          localStorage.removeItem("access_token");
          window.location.assign(
            "http://127.0.0.1:3000/public/index.html"
          );
        }
      };

      document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("access_token");

        if (!token) {
          window.location.assign(
            "http://127.0.0.1:3000/public/index.html"
          );
        } else {
          isAuthenticated(token);
        }
      });
    </script>
    <script>
      document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("access_token")
        localStorage.removeItem("refresh_token")
        
        window.location.assign("http://127.0.0.1:3000/public/index.html")
      })
    </script>
  </body>
</html>
